<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eudes Media - Africa Connect</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #004d40; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--bg); display: flex; justify-content: center; height: 100vh; }
        .app-container { width: 100%; max-width: 450px; background: white; display: flex; flex-direction: column; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        .header { background: var(--primary); color: white; padding: 15px; text-align: center; font-size: 20px; font-weight: bold; }
        
        /* Profile Section */
        .profile-card { padding: 15px; text-align: center; border-bottom: 1px solid #eee; background: #fff; }
        .profile-pic { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; background: #ddd; border: 2px solid var(--primary); }
        .bio { font-size: 13px; color: #666; margin: 5px 0; }
        
        /* Chat View */
        .chat-area { flex: 1; overflow-y: auto; padding: 15px; background: #e5ddd5; }
        .msg { background: white; padding: 10px; border-radius: 10px; margin-bottom: 10px; max-width: 85%; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .msg-header { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; }
        .msg-avatar { width: 30px; height: 30px; border-radius: 50%; }

        /* Input Area */
        .input-box { padding: 10px; display: flex; gap: 8px; background: #f0f0f0; align-items: center; }
        input[type="text"] { flex: 1; padding: 12px; border-radius: 25px; border: 1px solid #ddd; outline: none; }
        .call-btn { background: none; border: none; font-size: 20px; cursor: pointer; color: var(--primary); }
        .hidden { display: none; }
        .footer { font-size: 11px; text-align: center; padding: 10px; color: #999; border-top: 1px solid #eee; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">Eudes Media</div>
    
    <div class="profile-card">
        <img id="my-pic" class="profile-pic" src="https://cdn-icons-png.flaticon.com/512/149/149071.png">
        <div id="my-name" style="font-weight:bold; margin-top:5px;">eudesprince078</div>
        <div id="my-bio" class="bio">Member of Eudes Media Africa</div>
        <div style="display:flex; justify-content:center; gap:10px; margin-top:5px;">
            <button onclick="changePic()" style="font-size:11px;">Change Photo</button>
            <button onclick="changeBio()" style="font-size:11px;">Edit Bio</button>
        </div>
    </div>

    <div class="chat-area" id="chat-window"></div>

    <div class="input-box">
        <button class="call-btn" onclick="alert('Starting Video Call...')">ðŸŽ¥</button>
        <input type="text" id="msg-input" placeholder="Message to Africa...">
        <button onclick="sendMsg()" style="background:var(--primary); color:white; border:none; padding:10px 15px; border-radius:20px; cursor:pointer;">Send</button>
    </div>

    <div class="footer">Eudes Media | +256762992440</div>
</div>

<script>
    const URL = "https://kjftrwuucjdnhfwesrup.supabase.co";
    const KEY = "sb_publishable_1PetUo8klWCLfupRq52CVg_Y_YYrzcO";
    const sb = supabase.createClient(URL, KEY);

    let myEmail = "eudesprince078@gmail.com";
    let myAvatar = "https://cdn-icons-png.flaticon.com/512/149/149071.png";
    let myDescription = "Member of Eudes Media Africa";

    // Initialize: Load history and start Realtime
    window.onload = async () => {
        const { data } = await sb.from('Message').select('*').order('created_at', {ascending: true});
        if(data) data.forEach(m => displayMsg(m.username, m.content, m.avatar));

        sb.channel('any').on('postgres_changes', {event:'INSERT', schema:'public', table:'Message'}, 
        p => displayMsg(p.new.username, p.new.content, p.new.avatar)).subscribe();
    };

    function changePic() {
        const url = prompt("Paste an image URL for your profile photo:");
        if(url) {
            myAvatar = url;
            document.getElementById('my-pic').src = url;
        }
    }

    function changeBio() {
        const bio = prompt("Enter your Africa community bio:");
        if(bio) {
            myDescription = bio;
            document.getElementById('my-bio').innerText = bio;
        }
    }

    async function sendMsg() {
        const text = document.getElementById('msg-input').value;
        if(!text) return;

        // Saves to 'Message' table with the new columns
        await sb.from('Message').insert([{ 
            username: myEmail, 
            content: text, 
            avatar: myAvatar,
            description: myDescription 
        }]);
        document.getElementById('msg-input').value = "";
    }

    function displayMsg(user, text, img) {
        const win = document.getElementById('chat-window');
        const div = document.createElement('div');
        div.className = 'msg';
        const pic = img || 'https://cdn-icons-png.flaticon.com/512/149/149071.png';
        div.innerHTML = `
            <div class="msg-header">
                <img src="${pic}" class="msg-avatar">
                <strong>${user.split('@')[0]}</strong>
            </div>
            <div>${text}</div>
        `;
        win.appendChild(div);
        win.scrollTop = win.scrollHeight;
    }
</script>
</body>
</html>
